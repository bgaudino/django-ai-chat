{% load static ai_chat_tags %}
{{ config|json_script:"config" }}
<link rel="stylesheet" href="{% static 'ai_chat/css/chat.css' %}">
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
<link rel="stylesheet" href="{% static 'ai_chat/css/chat.css' %}">
<div class="pico chat" id="chat">
  <button class="chat__toggle" aria-expanded="false" aria-controls="chatWindow">ðŸ’¬</button>
  <article class="chat__window" id="chatWindow" role="dialog" aria-label="Chat">
    <header class="chat__header">
      <h3 class="chat__title">{{ config.CHAT_TITLE }}</h3>
      <button class="chat__close" aria-label="Close">âœ•</button>
    </header>
    <div class="chat__messages">
      {% for message in conversation %}
        <div class="chat__msg chat__msg--{{ message.role }}">
          {% if config.RENDER_MARKDOWN %}
            {{ message.content|safe_markdown }}
          {% else %}
            {{ message.content }}
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <form class="chat__inputbar"
          method="post"
          action="{% url 'chat' %}"
          id="chat-form">
      {% csrf_token %}
      {{ form.non_field_errors }}
      {{ form.message }}
      {% if form.message.errors %}
        {% for error in form.message.errors %}<small class="form-error">{{ error }}</small>{% endfor %}
      {% endif %}
      <div class="chat__actions">
        <button class="chat__clear secondary" type="submit" form="clear-form">
          Clear
          <button class="chat__send" type="submit">Send</button>
        </button>
      </div>
    </form>
    <form method="post" action="{% url 'clear_chat' %}" id="clear-form">
      {% csrf_token %}
    </form>
  </article>
</div>
